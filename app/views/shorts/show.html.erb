<div class="container">
	<div class="row">
		<div class="col-md-6 col-md-offset-3 text-center">
			<h1><%= @short.name %></h1>
		</div>

		<div class="col-md-1 col-md-offset-1">
			
			<input name="authenticity_token" type="hidden" value="<%= form_authenticity_token %>" />
			<div id="add-picture">
			</div>
			
		</div>

		<div class="col-md-1">
			
		</div>

	</div>

	<div class="album">
		<a href="/short/share/<%=@short.id%>">
      <span class='glyphicon glyphicon-share'></span>
    </a>
		<ul class="short-picture-list"> 
			<% @short.pictures.each do |pic| %>
				<li class="col-md-3 short-picture">
					<img src="<%= pic.image_url %>">
				</li>
			<% end %>
		</ul>
	</div>

</div>

<script>
	var zone = new FileDrop("add-picture");

	zone.event('send', function (files) {
  // FileList might contain multiple items.
  		files.each(function (file) {
    		
    		var fd = new FormData();
    		var userId = <%= session[:id] %>;
    		var signature = "<%= @signature %>";
    		var generatedFileName = userId + '_' + $.now();

			fd.append('type', 'image');
			fd.append('name', generatedFileName);
			fd.append('file', file.nativeFile); // <= here's where that HTML5 file handle goes

			$.ajax({
				url: 'http://api.astra.io/v0/public/diogeneshamilton/shorts?hmac=' + signature,
				type: 'POST',
				data: fd,
				contentType: false,
				processData: false,
				
				success: function(response) { 
					$.ajax({
						url: '/pictures',
						type: 'POST',
						data: {'original_filename': response.data.name, short_id: <%= @short.id %>, add: true},

						success: function(response) {
							
							$('.short-picture-list').append('<li class="col-md-3 short-picture"><img src="'+ response.image_url + '"></li>');
							$('#upload-photo-form').append('<input type="hidden" name="picture_ids[]" value="'+ response.id + '">')
						}
					});

					console.log('complete'); 
				}
			});


  		})
	})
	$('input.fd-file').addClass('btn btn-default');
</script>
